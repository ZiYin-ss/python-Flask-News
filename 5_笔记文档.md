#### 一,短信验证码分析

- 目的: 为了校验是一个真实的用户, 便于用户去注册
- 注意点
  1. 在获取短信验证码的时候需要携带的参数: 手机号, 随机字符串(uuid), 图片验证码
  2. 使用云通讯发送短信



#### 二,云通信集成

- 目的: 能够使用云通讯发送短信
- 操作步骤
  1. 先注册云通讯,创建应用
  2. 找到官方的demo实例,下载
  3. 拷贝模板代码自己的文件中(自己创建sms)
  4. 调用单例对象方法,发送短信即可



#### 三,短信验证码接口

- 目的: 当前端的页面,点击获取短信验证码的时候,能够获取一条短信

- 操作流程

  1. 获取参数
  2. 校验参数,图片验证码
  3. 校验参数,手机格式
  4. 发送短信,调用封装好的cpp
  5. 返回发送的状态

  ​	



#### 四,短信验证码接口完善

- 目的: 完善短信接口的编写
- 操作步骤
  1. 获取参数
  2. 参数的为空校验
  3. 校验手机的格式
  4. 通过图片验证码编号获取,图片验证码
  5. 判断图片验证码是否过期
  6. 判断图片验证码是否正确
  7. 删除redis中的图片验证码
  8. 生成一个随机的短信验证码, 调用ccp发送短信,判断是否发送成功
  9. 将短信保存到redis中
  10. 返回响应



#### 五,注册用户接口

- 目的: 创建一个用户对象,保存在数据库
- 操作步骤
  1. 获取参数
  2. 校验参数,为空校验
  3. 手机号作为key取出redis中的短信验证码
  4. 判断短信验证码是否过期
  5. 判断短信验证码是否正确
  6. 删除短信验证码
  7. 创建用户对象
  8. 设置用户对象属性
  9. 保存用户到数据库
  10. 返回响应



#### 六,注册用户接口完善

- 目的: 使用flask中提供好的方法,快速将前端的json数据转成dict
- 传统方法,json转dict
  1. json_data = request.data
  2. dict_data = json.loads(json_data)
- 快速将json转字典的方法
  - dict_data = request.json
  - dict_data = request.get_json()



#### 七,注册用户密码加密

- 目的: 使用flask中提供的安全模块,将密码进行加密
- 注意点
  - @property装饰方法之后,可以被属性使用
  - @属性.setter,给方法增加一个设置方式
  - generator_password_hash() 系统提供的加密方法
  - check_password_hash() 系统提供的密码校验方法



#### 八,登陆接口

- 目的: 写出登陆接口,供前端的工程师来调用登陆
- 操作流程
  1. 获取参数
  2. 校验参数,为空校验
  3. 通过用户手机号,到数据库查询用户对象
  4. 判断用户是否存在
  5. 校验密码是否正确
  6. 将用户的登陆信息保存在session中
  7. 返回响应



#### 九,首页右上角用户显示

- 目的: 在首页的右上角显示用户的登陆信息
- 操作流程
  1. 登陆用户之后,已经将session信息存储到redis了
  2. 当我们刷新首页的时候, 到session中获取了user_id的值
  3. 然后将用户的字典数据,携带到index.html首页展示了



#### 十,退出用户

- 目的: 在认证蓝图中编写退出接口
- 操作流程
  1. 清除session
  2. 返回响应



#### 十一,用户最后登陆时间

- 目的: 记录用户的登陆时间, 为了方便后期进行用户的活跃统计
- 工具: 
  - database工具,可以在pycharm中链接数据,方便查询等操作
  - structure: 可以快速查看当前文件的结构

![image-20181231161249039](5_笔记文档.assets/image-20181231161249039.png)

![image-20181231161431143](5_笔记文档.assets/image-20181231161431143.png)

#### 十二,自动提交

- 目的: 在flask通过sqlalchemy的属性配置,让数据库能够自动提交
- 操作流程
  - 在config的配置文件中,设置sqlalchemy_commit_on_teardown = True
  - 设置好了之后,当数据库的内容改变之后,视图函数在结束的时候就会自动提交了



#### 十三,CSRFProtect校验开启

- 目的: 在前端当中携带csrf_token, 以便csrf的校验能够通过

- 校验过程

  - 如果是非表单提交(ajax)
    - 1.在cookie中设置csrf_token (自己做)
    - 2.在请求头中设置csrf_token (自己做)
    - 服务器: 取出二者进行校验 (服务器做的,项目倒数第二天分析源代码)
  - 表单提交
    - 在表单设置一个隐藏字段即可

- CSRFProtect一旦保护好app之后会对如下请求做校验:

  - ```
    'POST', 'PUT', 'PATCH', 'DELETE'
    ```



#### 十四,热门新闻排行



#### 十五,分类数据展示

- 目的: 在首页的头部展示分类信息
- 操作流程
  1. 在根路径中查询所有的分类数据
  2. 将分类数据转成字典列表
  3. 携带分类数据渲染页面



#### 十六,首页新闻列表展示



- 目的: 编写新闻展示列表获取新闻数据,展示在首页中
- 操作步骤
  1. 获取参数
  2. 参数类型转换
  3. 分页查询
  4. 获取到分页对象中的属性,总页数,当前页,当前页的对象列表
  5. 将对象列表转成字典列表
  6. 携带数据,返回响应



#### 十七,新闻列表更多加载调试



#### 十八,分页切换调试



#### 十九,新闻详情页展示









